language: python


env: USER="uclgeog"
     LANG="en_US.UTF-8"
     LC_ALL="en_US.UTF-8"

#  # for packages on https://repo.anaconda.com/miniconda/

#  - osx
#  # for packages on https://repo.anaconda.com/miniconda/
#  env: MINI_OS="MacOSX"
#       MINI_ARCH="x86_64"
  
# not critical of os x fails
# mainly support linux
#jobs:
#  allow_failures:
#    - os: osx

os: 
  - "linux"
# - windows
# - osx
python:
  - "3.7"
  # for packages on https://repo.anaconda.com/miniconda/
#  - "3.6"      # current default Python on Travis CI
#
#   - "2.7"
#   env: MINI=Miniconda2
#  - "3.4"
#  - "3.5"
#   - "2.7"
#  - "3.4"
# - "3.5"
# conda from https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/use-conda-with-travis-ci.html


jobs:
  allow_failures:
    - os: 
      - "osx"
      - "windows"
    - python: 
      - "3.4"
      - "3.5"
      - "3.6"

before_install:
  # no support for python 2 here
  export MINI="Miniconda3"
  export MINI_ARCH="x86_64";
  - if [ "$TRAVIS_OS_NAME" = "osx" ];   then 
      export MINI_OS="MacOSX"; 
      # get brew for mac, for unix-y packages
      # https://brew.sh/
      /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"; 
      brew update; 
    fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then 
      export MINI_OS="Linux";
      # use apt-get for unix packages
      sudo apt update; 
    fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then 
      export MINI_OS="Windows";
      # use ??? for unix packages
      #
    fi   
  
install:
  # system requirements defined in apt.txt b ut also works for brew
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then cat apt.txt | xargs sudo apt-get install; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ] ;  then cat apt.txt | xargs brew install; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ] ;  then
      # not critical, probably
      echo "You will be missing some unix-y packages we might like"
      cat apt.txt 
    fi
    
  # download miniconda into $HOME/miniconda
  - wget https://repo.continuum.io/miniconda/${MINI}-latest-${MINI_OS}-${MINI_ARCH}.sh -O miniconda.sh;
  - bash miniconda.sh -b -p $HOME/miniconda
  - source "$HOME/miniconda/etc/profile.d/conda.sh"
  - hash -r
  - conda config --set always_yes yes --set changeps1 no
  - conda update -q conda
  # Useful for debugging any issues with conda
  - conda info -a

  # set up: uses information from meta.yaml
  - python setup.py install 
  # Replace dep1 dep2 ... with your dependencies
  # python=$TRAVIS_PYTHON_VERSION
  - conda env create -n uclgeog --file environment.yml
  - conda activate uclgeog
  - conda config --add channels proflewis
 
  # make the uclgeog codebase
  - python setup.py install
  - /bin/bash ./postBuild 
  - pwd
  - ls
  - cat ${HOME}/.jupyter/jupyter_notebook_config.json
# command to run tests
script:
  # this is in test.yml too ... resolve
  - python -c "import uclgeog"
